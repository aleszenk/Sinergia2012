<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="format-detection" content="telephone=no" />
<meta name="viewport"
	content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1" />
<link rel="stylesheet" type="text/css"
	href="css/jquery.mobile-1.2.0.min.css" />
<link rel="stylesheet" type="text/css" href="css/index.css" />
<script type="text/javascript"
	src="http://maps.google.com/maps/api/js?sensor=false"></script>
<script src="js/jquery-1.8.3.min.js"></script>
<script src="js/jquery.mobile-1.2.0.min.js"></script>
<script type="text/javascript" src="cordova-2.0.0.js"></script>
<script type="text/javascript" src="js/index.js"></script>
<script type="text/javascript" src="js/mapaSucursales.js"></script>
<script type="text/javascript" src="js/mapaCajeros.js"></script>
<script type="text/javascript" src="js/jMyCarousel.js"></script>
<style>
html,body,#map_canvasCajeros {
	margin: 0;
	padding: 0;
	height: 100%;
}
</style>
<script
	src="https://google-maps-utility-library-v3.googlecode.com/svn/trunk/geolocationmarker/src/geolocationmarker-compiled.js"></script>
<script type="text/javascript">
	
	//funcion que transforma array de bytes en strings base 64
	function encode(data) {
		var str = String.fromCharCode.apply(null, data);
		return btoa(str).replace(/.{76}(?=.)/g, '$&\n');
	}
	
	$(function() {
		
		/*se llama al servicio para cargar las imagenes y a partir de ahi se crea el carrousel
		si no hay imagenes en base ni conexion entonces no se muestra el carrousel.
		IMPORTANTE: hay que probar bien el metodo de conversion de byte array a imagenes en todos los SO 
		ya que al parecer versiones viejas de exploradores no soportan como src de la imagen data:image.......*/
		$
				.getJSON(
						'http://hp-hp/Sinergia2012/ServicioSinergia.svc/imagenes?callback=?',function(){							
						})
						.success(function(imagenes) {
							for (i = 0; i < imagenes.EnvioImagenesResult.length; i++) {
								$(".carrousel")
										.find("ul")
										.append(
												'<li><img src="data:image/jpg;base64,'
														+ encode(imagenes.EnvioImagenesResult[i])
														+ '" width="64" height="64"></li>');
							}
							if(imagenes.EnvioImagenesResult.length!=0){
								$(".carrousel").jMyCarousel({
									visible : '100%',
									auto : true,
									speed : 3000
								});
							}
						})
						.error(function(){
							alert("No se pudo establecer conexion con el servidor para cargar las imagenes");
						});
	});
</script>
<title>Sinergia 2012</title>
</head>
<body>
	<div data-role="page" id="Principal">
		<div data-role="header" id="hdrPrincipal" data-theme="b"
			data-nobackbtn="true">
			<h2>Sinergia 2012</h2>
		</div>
		<div data-role="content" data-theme="b" id="contentPrincipal">
			<p>
				<a
					href="http://localhost/ORT.ICBanking.MobileUI/SinergiaViewsLogin/Login1"
					data-role="button" data-transition="flow" id="transacciones">Transacciones</a>
			</p>
			<p>
				<a href="CajerosMapa.html" data-transition="flow" data-role="button">Cajeros
					autom√°ticos</a>
			</p>
			<p>
				<a href="SucursalesMapa.html" data-transition="flow"
					data-role="button">Sucursales</a>
			</p>
			<!-- 			Carrousel, hay que cambiarlo para que se cargue dinamicamente
				 a partir del servicio o que cargue del dispositivo -->
			<div class="carrousel">
				<ul>
				</ul>
			</div>
		</div>
		<div data-role="footer" data-theme="b" id="ftrPrincipal"
			data-position="fixed"></div>
	</div>
</body>
</html>
